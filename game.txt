#define _CRT_SECURE_NO_WARNINGS
#include <stdio.h>
#include <stdlib.h>
#include <Windows.h>

int x1 = 1;
int y1 = 1;
int x2 = 10;
int y2 = 10;
int power = 0;
int attack = 0;
int movement = 0;
int s = 0;
int potion = 0;
int teleporter = 0;
int extra_move = 0;
int money = 200;
int Lmove = 0;
char selectx = '1';
int selecty = 1;
int UItype = 1;

void intro();
void select_job();
void start_select();
void shop();
void status();
void draw_board(int x1, int y1, int x2, int y2);
void draw_UI();
void gotoxy(int x, int y);
void move();

int main() {

	intro();
	select_job();

	while (1) {
		start_select();
		if (s == 1) {
			UItype = 1;
			while (1) {
				
				draw_board(x1, y1, x2, y2);
				for (int i = 0; i < movement; i++) {
					draw_UI();
					move();
				}
			}
			
		}
		else if (s == 2) {
			shop();
		}
		else if (s == 3) {
			status();
		}

	}
	return 0;
}

void intro() {
	printf("c_turn_rpg ver.0.4");
	printf("\n");
	printf("up:8 down:2 left:4 right:6");
	printf("\n");
	printf("s to select");
	printf("\n");
	printf("Enter to start");
	getchar();
}

void select_job() {
	int select = 0;
	int select2 = 0;
	while (1) {
		system("cls");
		printf("choose your class.");
		printf("\n");
		printf("1:sworder 2:archer 3:mage");
		printf("\n");
		scanf("%d", &select);
		if (select == 1) {
			system("cls");
			printf("sworder\n");
			printf("power **\n");
			printf("range *\n");
			printf("movement 3\n");
			printf("* * *\n* @ *\n* * *\n");
			printf("Will you select?(y:1 n:2)\n");
			scanf("%d", &select2);
			if (select2 == 1) {
				power = 2;
				attack = 1;
				movement = 3;
				break;
			}
		}
		if (select == 2) {
			system("cls");
			printf("archer\n");
			printf("power ***\n");
			printf("range **\n");
			printf("movement 4\n");
			printf("    *\n    *\n* * @ * *\n    *\n    *\n");
			printf("Will you select?(y:1 n:2)\n");
			scanf("%d", &select2);
			if (select2 == 1) {
				power = 3;
				attack = 2;
				movement = 4;
				break;
			}
		}
		if (select == 3) {
			system("cls");
			printf("mage\n");
			printf("power ****\n");
			printf("range **\n");
			printf("movement 2\n");
			printf("* * * * *\n*       *\n*   @   *\n*       *\n* * * * *\n");
			printf("Will you select?(y:1 n:2)\n");
			scanf("%d", &select2);
			if (select2 == 1) {
				power = 2;
				attack = 1;
				movement = 3;
				break;
			}
		}
	}

}

void start_select() {
	system("cls");
	s = 0;
	int select = 0;
	printf("1:fight\n2:shop\n3:status\n");
	scanf("%d", &select);
	if (select == 1) {
		s = 1;
	}
	else if (select == 2) {
		s = 2;
	}
	else if (select == 3) {
		s = 3;
	}

}

void shop() {
	int num = 0;
	system("cls");
	while (1) {
		system("cls");
		printf("1:potion(10c)\n2:teleporter(50c)\n3:extra movement(70c)\n4:exit\n");
		scanf("%d", &s);
		if (s == 1) {
			system("cls");
			char a = NULL;
			printf("type number to buy(%d)\n", potion);
			scanf("%d", &num);
			if (num * 10 <= money) {
				money = money - num * 10;
				potion = potion + num;
			}
			else {
				printf("out of money\n");
				Sleep(1000);

			}
		}
		else if (s == 2) {
			system("cls");
			printf("type number to buy(%d)\n", teleporter);
			scanf("%d", &num);
			if (num * 50 <= money) {
				money = money - num * 50;
				teleporter = teleporter + num;
			}
			else {
				int n = 0;
				printf("out of money\n");
				Sleep(1000);
			}

		}
		else if (s == 3) {
			system("cls");
			printf("type number to buy(%d)\n", extra_move);
			scanf("%d", &num);
			if (num * 70 <= money) {
				money = money - num * 70;
				extra_move = extra_move + num;
			}
			else {
				printf("out of money\n");
				Sleep(1000);
			}
		}
		else {
			break;
		}
	}



}

void status() {
	system("cls");
	if (attack == 1) {
		printf("class:sworder\n");
		printf("power:%d\n", power);
		printf("range:1\n");
		printf("movement:%d\n", movement);
		printf("money:%d\n", money);
		printf("potion:%d\n", potion);
		printf("teleporter:%d\n", teleporter);
		printf("extra movement:%d\n", extra_move);
	}
	else if (attack == 2) {
		printf("class:archer\n");
		printf("power:%d\n", power);
		printf("range:3\n");
		printf("movement:%d\n", movement);
		printf("money:%d\n", money);
		printf("potion:%d\n", potion);
		printf("teleporter:%d\n", teleporter);
		printf("extra movement:%d\n", extra_move);
	}
	else if (attack == 3) {
		printf("class:mage\n");
		printf("power:%d\n", power);
		printf("range:2\n");
		printf("movement:%d\n", movement);
		printf("money:%d\n", money);
		printf("potion:%d\n", potion);
		printf("teleporter:%d\n", teleporter);
		printf("extra movement:%d\n", extra_move);
	}
	printf("1 to exit");
	int n = 0;
	scanf("%d", &n);
}

void draw_board(int x1, int y1, int x2, int y2) {
	system("cls");
	for (int y = 1; y < 11; y++) {
		for (int x = 1; x < 11; x++) {
			if (x1 == x) {
				if (y1 == y) {
					printf("@  ");
				}
				else if (x2 == x) {
					if (y2 == y) {
						printf("$  ");
					}
					else {
						printf("*  ");
					}
				}
				else {
					printf("*  ");
				}
			}
			else if (x2 == x) {
				if (y2 == y) {
					printf("$  ");
				}
				else {
					printf("*  ");
				}
			}
			else {
				printf("*  ");
			}

		}
		printf("\n");

	}
}

void draw_UI() {
	if (UItype == 1) {
		gotoxy(3,13);
		printf("left movement:%d\n\n", Lmove);
		printf("Move     Attack     Item     Run     ");
	}
	else if (UItype == 2) {
		gotoxy(3, 13);
		printf("move:");
	}
	else if (UItype == 3) {

	}
	else if (UItype == 4) {
		gotoxy(3, 13);
		printf("potion(%d)     teleporter(%d)     extra movement(%d)", potion, teleporter, extra_move);
	}
}

void gotoxy(int x, int y) {
	COORD pos = { x, y };
	SetConsoleCursorPosition(GetStdHandle(STD_OUTPUT_HANDLE), pos);
}

void move() {
	if (UItype == 1) {
		while (1) {
			if (selecty == 1) {
				gotoxy(5, 15);
			}
			else if (selecty == 2) {
				gotoxy(17, 15);
			}
			else if (selecty == 3) {
				gotoxy(26, 15);
			}
			else if (selecty == 4) {
				gotoxy(34, 15);
			}

			selectx = getch();
			if (selectx == '4') {
				if (selecty != 1) {
					selecty--;
				}
			}
			else if (selectx == '6') {
				if (selecty != 4) {
					selecty++;
				}
			}
			else if (selectx == 's') {
				break;
			}

		}
		if (selecty == 1) {
			UItype = 2;
		}
		else if (selecty == 2) {

		}
		else if (selecty == 3) {
			UItype = 3;
		}
	}
	if(UItype == 2) {
	
		int msel = 0;
		scanf("%d", &msel);
		if (msel == 8) {
			y1--;
		}
		else if (msel == 2) {
			y1++;
		}
		else if (msel == 4) {
			x1--;
		}
		else if (msel == 6) {
			x1++;
		}
	}
	
	
		
	
}